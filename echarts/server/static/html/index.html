<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge，chrome=1">
    <meta name="renderer" content="webkit">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="/static/css/cao.css">
    <!-- <link rel="stylesheet" type="text/css" href="/static/css/bootstrap.css"> -->
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/echarts.min.js"></script>
    <script src="/static/js/dark.js"></script>
    <script src="/static/js/echarts-wordcloud.min.js"></script>

</head>
<body>
   
<div class="header">
   <h1 style="font-Size:60px"><font>Hadoop+Spark+Hive航班机票数据分析可视化平台</font></h1>
</div>

<div class="main clearfix">
    <div class="main-left">
     
        <div class="border-container">
            <div id="rank"></div>
            <script>
                var barq5 = echarts.init(document.getElementById("rank"))
                     $.ajax({
                         type:"GET",
                         url:"/tables05",
                         dataType:"json",
                         success:function(data){
                             nbDatad(data)
                         }
                     })
                     function nbDatad(data){
 
 
                         var barq5Values = []
                         var barq5Names = []
                         for(var i =0;i< data.length;i++){
                             barq5Values.push(data[i].num) 
                             barq5Names.push(data[i].flight_company)
                         }
                         
                         const options = {
                             title:{
                                 text:"航空公司实力分析",
                                 left:20,
                                 top:20,
                                 textStyle:{
                                                 fontSize:30,
                                                 color:"	#b300ff"
                                             },
                             },
                             tooltip:{
                                         show:true
                                                 ,textStyle:{
                                             fontSize:30,
                                             color:"#00ffff",
                                         },
                                         formatter: "公司:{b}  飞机架数:{c} "
                                     },
                             grid:{
                                 top:'20%',
                                 left:'3%',
                                 right:"6%",
                                 bottom: "3%",
                                 containLabel:true 
                             },
                             xAxis:{
                                 type:"category",
                                 data:barq5Names,
                                 axisLabel: {
                                     textStyle: {
                                         color: "#00ffff",
                                         fontSize:30
                                     },
                                     fontSize:16//调整坐标轴字体大小
                     },
                             },
                             yAxis:{
                                 type:"value",
                             
                                 axisLabel: {
                             textStyle: {
                                 color: '#00ffff'
                             },
                             fontSize:25//调整坐标轴字体大小
                         }
                             },
                             textStyle: {
                                         color: '#51ffe2',  
                                         fontSize :20     
                                     },
                             
                             series:[
                                 {
                                     type:"bar",
                                     data:barq5Values,
                                     smooth: true,
                                     itemStyle: {
                                         color: "#99CCFF",
                                         barBorderRadius:[88,88,0,0],
                                         width: 20,
                                     },
                                     markPoint: {
                                             data: [
                                                 { type: 'max', name: 'Max' },
                                                 { type: 'min', name: 'Min' }
                                             ],
                                             symbol:'image://http://img30.360buyimg.com/poprx/jfs/t23662/172/668395134/12944/5653b1ff/5b3c2737N3d867c2f.png',
                                             symbolSize:[80, 80],
                                             symbolOffset:[0,-30],//位置偏移
                                             label: {
                                                 textStyle:{
                                                     fontSize:40,
                                                     color:"#0051ff"
                                                 },}
 
                                         }
 
                                 }
                             ]
                         }
                         barq5.setOption(options)
                     }    
                     </script>
            <ul class="three-pie clearfix">
                    <div id="pao"></div>
                    <script>
                        var msu = echarts.init(document.getElementById("pao"))       
                            $.ajax({
                                type:"GET",
                                url:"/tables03",
                                dataType:"json",
                                success:function(data){
                                    const msuwddata = data.map(function(item){
                                        return {
                                            name:item.flight_type1,
                                            value:item.num,
                                            
                                        }
                                    })
        
                                    
                                    const leidaoptions = {
                                                title:{
                                                    text:"飞机型号占比分析",
                                                    left:20,
                                                    top:20,
                                                    textStyle:{
                                                fontSize:30,
                                                color:"#b300ff",
                                        }
        
                                                },
                                                tooltip:{
                                        show:true
                                                ,textStyle:{
                                            fontSize:30,
                                            color:"#00ffff",
                                        },
                                        formatter: "型号:{b}  航班数量:{c} 占比{d}%"
                                    },
                                                legend: {
                                                    top: '85%',
                                                    left: 'center',
                                                    textStyle:{
                                                fontSize:30,
                                                color:"#ff",
                                        }
                                                },
                color: ['#00FFFF','#0066FF','#9900FF ','#FF69B4 ','#FFA07A','#66CCFF','#99CC66','#CCFFFF ','	#00FF99 ','#008888'],
                                                
                                               
                                                series: [
                                                {
                                                name: '比例',
                                                radius: ['40%', '70%'],
                                                // roseType: 'radius',
                                                min: 756,
                                                max:810,
                                                type:"pie",
                                                width: '50%',
                                                data:msuwddata,
                                                label: {
        
                                                    show: false,
                                                    position: 'center',
                                                },
                    }
                                                ]
                                            }
                                    msu.setOption(leidaoptions)
                                }
                            })
        
        
                            </script>
            </ul>
            <span class="top-left border-span"></span>
            <span class="top-right border-span"></span>
            <span class="bottom-left border-span"></span>
            <span class="bottom-right border-span"></span>
        </div>
    </div>
    <div class="main-middle">
        <div class="border-container">
            <div id="map"></div>
            <div class="number-show">
              <!--动态图位置-->
                          <script>

                var localAllData  = []
                var timerId = 0
                var startIndex
                var endIndex
        
        
                var ads_scprice_info = echarts.init(document.getElementById("map"))
        
                ads_scprice_info.on("mouseover",function(){
                    clearInterval(timerId)
                })
        
                ads_scprice_info.on("mouseout",function(){
                    startlocalInterval(localAllData)
                })
        
                window.addEventListener("resize",screenAdapter)
        
        
            
                $.ajax({
                    type:"GET",
                    url:"/tables01",
                    dataType:"json",
                    success:function(data){
                        localAllData = data
                        console.log(localAllData)
                        showlocalData(localAllData)
                        startlocalInterval()
                        
                    }
                })
                function showlocalData(data){
        
                    // data.sort((b, a) => {
                    //     return a.dollars- b.dollars// 从小到大的排序
                    // })
            
        
                    var local_price = []
                    var localname = []
        
                    for(var i =0;i< data.length;i++){
                        local_price.push(data[i].price_desc_math) 
                        localname.push(data[i].airline_name) 
                        length = data.length
                        startIndex = length
                        endIndex = length - 5
                    }
                    console.log(local_price)
                    console.log(localname)
        
                    const options = {
                        title:{
                            text:"实时航班优惠力度榜单",
                            left:20,
                            top:20,
                            textStyle:{
                                fontSize:40,
                                color:'#00FFFF'
                            }
                        },
                        tooltip:{
                            trigger:'axis',
                            axisPointer:{
                                type:'shadow',
                                lineStyle:{
                                    color:'#2D3443',
                                    fontSize:30
                                }
                            },
                            show:true,
                            textStyle:{
                                    fontSize:40,
                                    color:"#00ffff"
                            },                
                            formatter: "航班:{b}  优惠力度:{c} (折)"
                        },
                        dataZoom:{
                                show:true,
                                yAxisIndex: 0,
                                startValue:startIndex,
                                endValue:endIndex,
                                fontSize:40,
                            },
                        //调整坐标系的位置
                        grid:{
                            top:'20%',
                            left:'3%',
                            right:"6%",
                            bottom: "3%",
                            containLabel:true // 距离是包含坐标轴上的文字的
                        },
                        xAxis:{
                            type:"value",
                            axisLabel : {
                                color:'#00FFFF'
                            }
                        },
                        yAxis:{
                            type:"category",
                            data:localname,
                            //fontSize:40,
                            axisLabel : {
                                fontSize:30,
                                color:'#00FFFF'
                            }
                        },
                        series:[
                            {
                                type:"bar",
                                data:local_price,
                                barWidth:60,
                                label:{
                                    show:true,
                                    position:"right",
                                    color:'white'
                                },
                                itemStyle:{
                                    // 设置条柱的四个角的圆角半径
                                    barBorderRadius:[0,30,30,0],
                                    //前面四个参数表示的是渐变色的方向
                                    //00表示左上角
                                    //10表示右上角
                                    //0,0,1,0 表示了渐变的方向，从左上角到右上角
                                    color:new echarts.graphic.LinearGradient(0,0,1,0,[
                                        //颜色过渡的过渡值
                                        {
                                            //起始的颜色
                                            offset:0,
                                            color:'#014871'
                                        },
                                        {
                                            //100%位置的颜色
                                            offset:1,
                                            color:'#A0EBCF'
                                        }
                                    ])
                                }
                            }
                        ]
                    }
                    ads_scprice_info.setOption(options)
                }
        
        
        
        
                function screenAdapter(){
                    const titleFontSize = document.getElementById("ads_scprice_info").offsetWidth / 100 * 3.6
                    const adapterOptions = {
                        title:{
                            textStyle:{
                                fontSize:titleFontSize
                            }
                        },
                        tooltip: {
                            trigger: 'axis',
                            axisPointer: {
                                type: 'shadow',
                                lineStyle: {
                                    color: '#2D3443',
                                    
                                }
                            }

                        },
                        series:[
                            {
                                barWidth:titleFontSize,
                                itemStyle:{
                                    // 设置条柱的四个角的圆角半径
                                    barBorderRadius:[0,titleFontSize/2,titleFontSize/2,0]
                                }
                            }
                        ]
                    }
                    //setOption方法可以重复调用，echarts内部，不会进行覆盖叠加，整合
                    ads_scprice_info.setOption(adapterOptions)
                    ads_scprice_info.resize()
        }
        
                function startlocalInterval(){
        
                    if (timerId){
                        clearInterval(timerId)
                    }
                    timerId = setInterval(function(){
                        startIndex -= 1
                        endIndex -= 1
                        if (endIndex < 0 ){
                            startIndex = length - 5
                            endIndex = length 
                        }
                        const updateOption = {
                            dataZoom:{
                                startValue:startIndex,
                                endValue:endIndex
                            }
                        }
                        ads_scprice_info.setOption(updateOption)
        
                    },1000)
                }
                
            </script> 
            </div>
            <span class="top-left border-span"></span>
            <span class="top-right border-span"></span>
            <span class="bottom-left border-span"></span>
            <span class="bottom-right border-span"></span>
        </div>
        <div class="border-container">
            <ul class="teacher-pie clearfix">
          
            <div id="barq5"></div>
              <script>
                        var pao = echarts.init(document.getElementById("barq5"))
                        var paostartIndex = 0
                        var paoendIndex = 10
                        var paotimerId = 0
                        var paoallData = []
                        pao.on("mouseover",function(){
                            clearInterval(paotimerId)
                        })
                        pao .on("mouseout",function(){
                            startInterval()
                        })
                        $.ajax({
                            type:"GET",
                            url:"/tables04",
                            dataType:"json",
                            success:function(data){
                                paoallData = data
                                const colorArr = [
                                ['#5052EE', '#AB6EE5'],
                                ['#8B8970', '#FFE1FF'],
                                ['#23E5E5', '#2E72BF'],
                                ]
                                
                                销售_arr = data.map(function(item){
                                    return item.stime;
                                })
                                value_arr = data.map(function(item){
                                    return item.num
                                })  

                                const option = {
                                    title:{
                                    text:"近期起飞架次",
                                    left:20,
                                    top:20,
                                    textStyle:{
                                        fontSize:30,
                                        color:"#00ffff"
                                        }                   
                                    },
                                    grid:{
                                    top:'20%',
                                    left:'3%',
                                    right:"6%",
                                    bottom: "3%",
                                    containLabel:true // 距离是包含坐标轴上的文字的
                                    },
                                    dataZoom:{
                                        show:true,
                                        startValue:paostartIndex,
                                        endValue:paoendIndex
                                    },
                                    tooltip:{
                                                show:true,
                                                    textStyle:{
                                                    fontSize:30,
                                                    color:"#00ffff",
                                                },
                                                
                                                formatter: "时间:{b}  起飞架次:{c}"

                                            },
                                    xAxis:{
                                                type:"category",
                                                data:销售_arr,
                                                axisLabel: {
                                                    // rotate:-40,
                                                        textStyle: {
                                                            color: '#00ffff',
                                                            fontSize:20
                                                        },
                                                        fontSize:20//调整坐标轴字体大小
                                                    }
                                            },        
                    
                                            yAxis:{
                                                        type:"value",
                                                        axisLabel: {
                                                                textStyle: {
                                                                    color: '#00ffff'
                                                                },
                                                                fontSize:25//调整坐标轴字体大小
                                                            }
                                                    },
                                    series:[
                                        {
                                            type: 'scatter',
                                            data:value_arr,
                                            symbolSize: function(data) {
                                            //return Math.sqrt(data*0.3)/ 1e1 ;
                                            //return Math.sqrt(data)*9 ;
                                            return Math.sqrt(data) ;
                                            },
                                        
                
                                            itemStyle:{
                            
                                                color:function(arg){
                                                    var targetColorarr = null
                                                    if(arg.value >= 65){
                                                        targetColorarr = colorArr[0]
                                                    }else if(arg.value >= 35){
                                                        targetColorarr = colorArr[1]
                                                    }else{
                                                        targetColorarr = colorArr[2]
                                                    }
                                                    return new echarts.graphic.LinearGradient(0,0,0,1,[
                                                        {
                                                            offset:0,
                                                            color:targetColorarr[0]
                                                        },
                                                        {
                                                            offset:1,
                                                            color:targetColorarr[1]
                                                        }
                                                    ])
                                                }
                                            }
                                        }
                                    ]
                                }
                                pao.setOption(option)
                                paostartInterval()
                            }
                        })
                        
                        function paostartInterval(){
                            if (paotimerId){
                                clearInterval(paotimerId)
                            }
                            paotimerId = setInterval(function(){
                                paostartIndex += 1
                                paoendIndex += 1
                                if (paoendIndex > paoallData.length -1 ){
                                    paostartIndex = 0
                                    paoendIndex = 9
                                }
                                const updateOption = {
                                    dataZoom:{
                                        startValue:paostartIndex,
                                        endValue:paoendIndex
                                    }
                                }
                                pao.setOption(updateOption)

                            },2500)
                        }
                    </script>
            
            <span class="top-left border-span"></span>
            <span class="top-right border-span"></span>
            <span class="bottom-left border-span"></span>
            <span class="bottom-right border-span"></span>
        </div>
    </div>
    <div class="main-right">
        <div class="border-container">
            <div id="line"></div>
            
                  <script>
                    var line = echarts.init(document.getElementById("line"))
              
                    $.ajax({
                        type:"GET",
                        url:"/tables06",
                        dataType:"json",
                        success:function(data){
                            showqiData(data)
                        }
                    })
                    function showqiData(data){
                    
                        const qivalue = data.map(function(item){
                            return {
                                name:item.airline_name,
                                value:item.price,
                            }
                        })            
                        const options = {
                            title:{
                                text:"最新机票价格榜单",
                                left:20,
                                top:0,
                                textStyle:{
                                    fontSize:30,
                                    color:"#00ffff",
                                }
                            },
                            tooltip: {
                                trigger: 'item',
                                formatter: '{b} : {c} ({d}%)',
                                textStyle:{
                                    fontSize:30,
                                    color:"#00ffff",
                                },
                                formatter: "航班:{b}  价格:{c} "
                                },
                            legend: {
                                top: '93%',
                                left: 'center',
                                
                                textStyle:{
                            fontSize: 30,//字体大小
                            color: ['#1E90FF','#7D7DFF ','#FF79BC','#9F35FF','#616130'],
                    },
                            },
                            color: ['#1E90FF','#7D7DFF ','#FF79BC','#9F35FF','#616130'],
                            series: [
                                    {
                                        type:'funnel',
                                        left: '12%',
                                        top: 50,
                                        // bottom: 60,
                                        width: '80%',
                                        // min: 2642008,
                                        min: 490,
                                        max: 8400,
                                        minSize: '45%',              //每一块的最小宽度
                                        maxSize:'95%',               //每一块的最大宽度   一次去除掉尖角
                                        sort: 'descending',
                                        gap: 20,                //每一块之间的间隔
                                        fontSize: 40,
                                        labelLine: {           
                                            length: 30,             //设置每一块的名字前面的线的长度
                                            lineStyle: {
                                                width: 1,         //设置每一块的名字前面的线的宽度
                                                type: 'solid' 
                                                   //设置每一块的名字前面的线的类型
                                            }
                                        },
                                        itemStyle: {
                                            normal: { 
                                                borderColor: '#fff',        //每一块的边框颜色
                                                borderWidth: 0,             //每一块边框的宽度
                                                shadowBlur: 50,             //整个外面的阴影厚度
                                                shadowOffsetX: 0,
                                                shadowOffsetY: 50,          //每一块的Y轴的阴影
                                                shadowColor: 'rgba(0, 0, 0, 0.5)'    //阴影颜色
                                            }
                                        },
                                        emphasis: {
                                            label: {
                                                fontSize: 20
                                            }
                                        },
                                        data:qivalue
                                    }
                ]
                        }
                        line.setOption(options)
                    }   
                </script>
                <span class="top-left border-span"></span>
                <span class="top-right border-span"></span>
                <span class="bottom-left border-span"></span>
                <span class="bottom-right border-span"></span>
            </div>
       
        <div class="border-container">
            <div id="qi"></div>
            <script>
                var wd2 = echarts.init(document.getElementById("qi"))
                    $.ajax({
                        type:"GET",
                        url:"/tables02",
                        dataType:"json",
                        success:function(data){
                            showsportnumlData(data)
                        }
                    })

                    function showsportnumlData(data){

                        const worldcound = data.map(function(item){
                            return {
                                name:item.start_airport_simple,
                                value:item.num,
                                
                            }
                        })
                        var option = {
                            title:{
                                    text:"热门机场(词云)",
                                    right:0,
                                    top:20,
                                    textStyle:{
                                        fontSize:30,
                                        color:"#b300ff",
                                }
                            },
                          
                            tooltip:{
                                show:true
                                        ,textStyle:{
                                    fontSize:30,
                                    color:"#00ffff",
                                },
                                formatter: "机场:{b}  起飞架次:{c}"
                            },
                            series: [{
                                type: 'wordCloud',
                                sizeRange: [70, 135],
                                rotationRange: [-45, 0, 45, 90],
                                rotationStep: 45,
                                gridSize: 25    ,
                                shape: 'triangle-forward',
                                width: '100%',
                                height: '100%',
                                textStyle: {
                                    normal: {
                                        
                                        color: function () {
                                            return 'rgb(' + [
                                                Math.round(Math.random() * 400),
                                                Math.round(Math.random() * 400),
                                                Math.round(Math.random() * 400)
                                            ].join(',') + ')';
                                        }
                                    }
                                },
                                data:worldcound
                            }]
                            
                        }
                        wd2.setOption(option)
                    }

                    function screenAdapter(){
                        const titleFontSize = document.getElementById("worldcound").offsetWidth /3
                        const adapterOptions = {
                            title:{
                                textStyle:{
                                    fontSize:titleFontSize
                                }
                            },
                        }
                        wd2.setOption(adapterOptions)
                        wd2.resize()
            }
                </script>
            
            <span class="top-left border-span"></span>
            <span class="top-right border-span"></span>
            <span class="bottom-left border-span"></span>
            <span class="bottom-right border-span"></span>
        </div>
    </div>
</div>
</body>
</html>